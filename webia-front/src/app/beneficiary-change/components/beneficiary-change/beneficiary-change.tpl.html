<ng-template ngbModalContainer></ng-template>
<div class="split-screen relative" >
  <div [ngBusy]="subs">
    <workflow-header
        [workflowName]="'Beneficiary Change'"
        [workflowItemId]="step?.workflowItemId"
        [workFlowStatus]="step?.workFlowStatus"
        [assignedTo]="step?.assignedTo"
        [polId]="step?.polId"
        [applicationForm]="step?.applicationForm"
        [productCd]="step?.productCd"
        [productName]="step?.productName"
        [secondCpsUser]="secondCpsUser"
        [firstCpsUser]="firstCpsUser"            
        [rejectable]="step?.stepRejectable"
        [mode]="headerMode"
        [commentsData]="commentsData"
        [rejectsData]="rejectsData"
        [canAbort]="step?.stepAbortable"
        (onSave)="save()"
        (onAbort)="abort()"
        (onNext)="next()"
        (onReject)="reject()"
        (onAddStepComment)="addStepComment($event)"
    >
        <ng-container ngProjectAs="additionnal-buttons">
            <button class="btn btn-xs btn-primary" (click)="simulate()" [desactive]="headerMode" *ngIf="isSimulationAvailable && !!step?.polId">
                <i class="fa fa-file-pdf-o" aria-hidden="true"></i> Simulation
            </button>
        </ng-container>
    </workflow-header>

    <div class="row">
        <div [ngClass]="{'col-xs-6' : viewSimulation, 'col-xs-7' : !viewSimulation}" class="form-horizontal" *ngIf="step?.formData">
            <beneficiary-change-analysis 
                [usersList]="usersList" 
                [form]="step?.formData"
                [stepName]="step?.stepWorkflow"
                [workflowItemId] = "step?.workflowItemId"
                [isWorkflowCompleted] = "step?.workFlowStatus == 3"
                [policyIdDisabled] = "!!step?.polId"
                [mode]="formsMode">
            </beneficiary-change-analysis>
        </div>
        <div [ngClass]="{'col-xs-6' : viewSimulation, 'col-xs-5 paddingLeft' : !viewSimulation}" class="paddingLeft">
            <div *ngIf="viewSimulation" [@enterAnimation]>
                <simulation
                    [loadObservable]="simulationObservable" 
                    (onClose)="onSimulationClose()"
                    (onRefresh)="refresh()">
                </simulation>
            </div>
            <div *ngIf="!viewSimulation" [@enterAnimation]>
                <survey
                    [inputData]="step?.checkSteps"  
                    [workflowItemId]="step?.workflowItemId" 
                    [stepWorkflow]="step?.stepWorkflow"
                    [mode]="surveyMode">
                </survey>
            </div>
        </div>
    </div>
  </div>
</div>