<div class="relative">
<div [class.form]="useFormClass" [ngBusy]="subs">
    <section subject="premium-and-fees">
        <div class="row">
            <div class="title col-md-6 col-md-offset-1">Premium & Fees</div>
        </div>
        <div class="row">
            <label class="marginTop col-md-4  margin-appnr text-right">Application Nr</label>        
            <div class="form-group col-md-2">
                <input type="text" class="form-control input-sm" maxlength="20" [(ngModel)]="a.applicationForm" [desactive]="mode">
            </div>
        </div>
        <div class="row">
            <label class="marginTop col-md-2 text-right">Expected Premium</label>
            <div class="form-group col-md-2">
                <!--<input type="text" currencyFormatter class="form-control input-sm text-right" [(ngModel)]="a.expectedPremium" [desactive]="mode">-->
                <w-number  [(number)]="a.expectedPremium" css="form-control input-sm text-right" [mode]="mode" ></w-number>
            </div> 
            <label class="marginTop col-md-4 text-right">Currency of contract</label>
            <div class="form-group col-md-2">
                <select class="form-control input-sm currency-select" [(ngModel)]="a.contractCurrency" id="currency" name="currency" [desactive]="mode">
                    <option *ngFor="let c of currencyList" [ngValue]="c.ccyId">{{c.ccyId}}</option>
                </select>
            </div> 
        </div>
        <div class="row form-inline">
            <label class="marginTop col-md-2 text-right">Entry fees</label>
            <div class="form-group col-md-4">
                <percent-amount    [(percent)]="a.entryFeesPct"
                                [(flatAmount)]="a.entryFeesAmt"
                                [currency]="a.contractCurrency"
                                [(currencyList)]="currencyList"
                                [defaultCurrency]="a.contractCurrency"
                                [disabled]="mode =='readOnly' || mode == 'waiting'"
                                [disabledCurrency]="true"
                                (unityChange)="unityChange($event)"
                                (percentChange)="changeFeesType($event)"
                                (flatAmountChange)="changeFeesType($event)"></percent-amount >
            </div> 
            <label class="marginTop col-md-2 text-right">Admin fees</label>
            <div class="form-group w-col-md-3 paddingRight">
                <!--<input type="text" class="form-control input-sm text-right" [desactive]="mode" currencyFormatter [currencyOptions]="{precision:6}" size=3 [(ngModel)]="a.mngtFeesPct" >%-->
                <w-number  [(number)]="a.mngtFeesPct" css="form-control input-sm text-right input-percent" [precision]="6" [mode]="mode" (numberChange)="updateCompanyManagementFees()"></w-number>%
            </div> 
            <label class="marginTop w-col-md-3 text-right paddingLeft">Surrender fees</label>        
            <div class="form-group col-md-2 paddingRight">
                <!--<input type="text" class="form-control input-sm text-right" [desactive]="mode" currencyFormatter [currencyOptions]="{precision:6}" size=3 [(ngModel)]="a.tobedefined" >%-->
                <w-number  [(number)]="a.surrenderFees" css="form-control input-sm text-right input-percent" [precision]="6" [mode]="mode" ></w-number>%
            </div> 
        </div>
    </section>

    <section subject="partners">
        <div class="row">
            <div class="title col-md-6 col-md-offset-1">Partners</div>
        </div>
        <div class="row form-inline"> <!-- 'BK'  -->
            <label class="marginTop col-md-2 text-right">Broker</label>
            <div class="form-group w-col-md-9 form-inline paddingRight">
                <search-agent   [(agentId)]="a.broker.partnerId"
                                [labelFn]="name_status" 
                                [type]="'BK'" 
                                [disabled]="mode =='readOnly' || mode =='waiting'" 
                                [allowClear]="false"
                                (agentIdChange)="checkFoyerAgent()" 
                                (onChange)="updateBroker($event, a.broker, agtCat.BROKER)" >
                </search-agent> 
            </div>
            <div class="form-group col-md-6 nopadding">
                <label class="text-right col-md-3 marginTop nopadding">Broker entry fees</label>
                <div class="col-md-3 marginTop" *ngIf="isEntryFeesPCT==true">
                    <w-number   [(number)]="a.broker.entryFeesPct" 
                                [disabled]="disableFees==true" css="form-control input-sm text-right input-percent" 
                                [precision]="6" 
                                [mode]="mode" 
                                (numberChange)="updateCompanyEntryFees()">
                    </w-number>%
                </div>
                <div class="col-md-3 marginTop" *ngIf="isEntryFeesPCT!=true" >
                    <w-number  [(number)]="a.broker.entryFeesAmt" [disabled]="disableFees==true" css="form-control input-sm text-right input-percent" [mode]="mode" (numberChange)="updateCompanyEntryFees()"></w-number><span>{{ a.contractCurrency }}</span>
                </div> 
                <label class="form-group w-col-xs-6 text-right marginTop">Broker admin fees</label>
                <div class="col-xs-3 text-left">
                    <w-number  [(number)]="a.broker.mngtFeesPct" [disabled]="disableFees==true" css="form-control input-sm text-right input-percent" [precision]="6" [mode]="mode" (numberChange)="updateCompanyManagementFees()"></w-number>%
                </div>
            </div>
        </div>
        <div class="row marginVertical"> 

            <div class="form-horizontal">
                <div class="col-md-4 col-md-offset-2 nopadding">
                    <ng-container *ngIf="!this.disableFees">
                            <label class="control-label col-md-6 nopadding">Mandate transmission</label>
                            <div class="radio col-md-6 nopadding">
                            <label class="radio-inline">
                                <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="mandateBroker"  [value]="true" [checked]="a.broker.partnerAuthorized" [(ngModel)]="a.broker.partnerAuthorized">
                                <span class="cr"><i class="cr-icon fa fa-circle"></i></span>Yes
                            </label>
                            <label class="radio-inline">
                                <input class="form-control input input-sm"  [desactive]="enableMode(stepName)" type="radio" name="mandateBroker"  [value]="false" [checked]="!a.broker.partnerAuthorized" [(ngModel)]="a.broker.partnerAuthorized">
                                <span class="cr"><i class="cr-icon fa fa-circle"></i></span>No
                            </label>                                                
                        </div>
                    </ng-container>                 
                </div>
            </div>


            <label class="marginTop w-col-md-3 text-right nopadding">Contract Ref</label>
            <div class="col-md-2">
                <input type="text" class="form-control input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="a.brokerRefContract" >
            </div>
        </div>

        <div class="row marginBottom2" *ngIf="a && a.brokerContact && !isWealins(a.broker)">
            <label class="marginTop col-md-2 text-right">Contact person</label>
            <div class="form-group col-md-5">
                <ng-container>
                    <agc-add-select initialFunction="CPS" [disabled]="(a && a.broker && (!selectedAgent.broker || !a.broker.partnerId)) || (mode!='edit')" css="form-control input-sm" [(agent)]="selectedAgent.broker" [(contactId)]="a.brokerContact.partnerId"></agc-add-select> 
                </ng-container>            
            </div>
        </div>

        <div class="row marginBottom2" *ngIf="showSubBroker"> 
            <label class="marginTop col-md-2 text-right">Sub-broker</label>
            <div class="form-group col-md-5">
                <span class="form-inline">
                    <select class="form-control input-sm text-left" [(ngModel)]="a.subBroker.partnerId" [desactive]="mode" (change)="refreshMail2AgentList()">
                        <option [ngValue]="undefined"></option>
                        <ng-container *ngIf="subBrokerList && subBrokerList.length>0">
                            <option *ngFor="let a of subBrokerList" [ngValue]="a.agtId"><span [innerHtml]="a.name"></span></option>
                        </ng-container>
                    </select> 
                </span>  
            </div> 

        </div>

        <div class="row">
            <label class="marginTop col-md-2 text-right">Country Manager</label>
            <div class="col-md-6">
                <ng-template ngFor let-countryManager [ngForOf]="a.countryManagers" let-i="index" let-last="last">
                    <div class="row">
                        <div class="form-inline col-md-7">
                            <div class="form-group">
                                <select class="form-control input-sm text-left" [(ngModel)]="countryManager.partnerId" (ngModelChange)="removeCountryManager(null)" [desactive]="mode">
                                    <option value=""></option>
                                    <option *ngFor="let a of countryManagerList" [ngValue]="a.agtId">{{a.name}}</option>
                                </select>
                                <button *ngIf="(a.countryManagers && a.countryManagers.length>1)" class="btn btn-sm btn-primary" (click)="removeCountryManager(countryManager)" [desactive]="mode"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                <button *ngIf="last" class="btn btn-sm btn-primary" (click)="showAdditionalCM=true" [desactive]="mode"><i class="fa fa-plus" aria-hidden="true"></i></button>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="form-horizontal">
                                <div class="form-group">
                                    <label *ngIf="(a.countryManagers && a.countryManagers.length > 1)" class="col-md-3 control-label">Split</label>
                                    <div *ngIf="(a.countryManagers && a.countryManagers.length>1)" class="col-md-6 form-inline">
                                        <!--<input type="text" class="form-control input-sm" [desactive]="mode" currencyFormatter [currencyOptions]="{precision:6}" size=2 [(ngModel)]="countryManager.split">%-->
                                        <w-number  [(number)]="countryManager.split" css="form-control input-sm text-right input-percent" [precision]="6" [mode]="mode" ></w-number>%
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>                
                </ng-template>
                <div class="row" *ngIf="countryManagerList && (a.countryManagers.length==0 || showAdditionalCM)">
                    <div class="form-inline col-md-8">
                        <div class="form-group">
                            <select class="form-control input-sm text-left" [(ngModel)]="partner_tmp" (ngModelChange)="addCountryManager($event)" [desactive]="mode">
                                <option value=""></option>
                                <option *ngFor="let a of remainCountryManagerList" [ngValue]="a.agtId">{{a.name}}</option>
                            </select>
                            <button class="btn btn-sm btn-primary" *ngIf="a.countryManagers && a.countryManagers.length>1" (click)="showAdditionalCM=false" [desactive]="mode"><i class="fa fa-minus" aria-hidden="true"></i></button>
                        </div>                   
                    </div>
                </div>            
            </div>        
        </div>    
        <div class="line-break-thin"></div>
        <div class="row" *ngIf="isWealins(a.broker)">
            <label class="marginTop col-md-2 text-right">Business Introducer</label> <!-- 'IN'  -->
            <div class="form-group w-col-md-9 form-inline paddingRight">
                <search-agent  [(agentId)]="a.businessIntroducer.partnerId"  
                                [labelFn]="name_status" 
                                [type]="['IN','AM','DB']" 
                                [disabled]="mode =='readOnly' || mode =='waiting'" 
                                [allowClear]="!disableFees">
                </search-agent> 
            </div> 
            <div class="form-group col-md-6 form-inline">
                <label class="col-md-4 marginRight3 marginTop">Bus.Introducer entry fees </label>
                <w-number  [(number)]="a.businessIntroducer.entryFeesPct" css="form-control input-sm text-right input-percent" [precision]="6" [mode]="mode"></w-number>%
            </div>   
        </div>
        <div class="line-break-big"></div>
    </section>

    <section subject="term">
        <div class="row">
            <label class="title col-md-2 col-md-offset-1">Term</label>
            <div class="col-md-6 radio">
                    <label class="marginTop">
                        <input class="form-control" name="term" type="radio" 
                                (change)="selectTermByCode(whole_life)" 
                                [checked]="term==whole_life" 
                                [disabled]="mode=='readOnly' || mode=='waiting' || product?.isNotCapi===false">
                                <span class="cr"><i class="cr-icon fa fa-circle"></i></span>Whole Life
                    </label>
                    <label class="marginTop">
                        <input class="form-control" name="term" type="radio" 
                                (change)="selectTermByCode(year_term)"  
                                [checked]="term==year_term" 
                                [disabled]="mode=='readOnly' || mode=='waiting' || product?.isNotCapi===false"><span class="cr"><i class="cr-icon fa fa-circle"></i></span>Nb of Years
                    </label>
                    
                    <!--<input type="text" class="form-control input-sm text-right" [desactive]="mode" [disabled]="a.term!=1" currencyFormatter [currencyOptions]="{precision:0}" size=2 [(ngModel)]="a.tobedefined">-->
                    <w-number *ngIf="term==year_term" [(number)]="a.term" css="form-control input-sm text-right input-percent" [precision]="0" [mode]="mode" [disabled]="term==whole_life"></w-number>
            </div>
        </div>
    </section>

    <section subject="clients">
        <div class="row">
            <div class="title col-md-6 col-md-offset-1">Clients</div>
        </div>
        <div class="row client"> <!-- PH = policyHolder-->
            <div class="policyholder">
                <ng-template ngFor let-client [ngForOf]="a.policyHolders" let-i="index" let-last="last">
                    <div class="col-xs-12 nopadding">
                    <label class="policyholder-caption marginTop col-md-2 text-right">Policyholder ({{ client?.displaNumber }})</label>
                        <div class="form-group col-md-10 form-inline text-left" [ngClass]="{'policyholder-form-group' : product?.nlCountry=='FRA'}">
                            <div class="row">
                                <div class="col-md-8">
                                    <search-client [includeDeceased]="false" [(clientId)]="client.clientId" (onChange)="updatePolicyHolder($event)" [disabled]="mode == stateMode.readonly || mode == stateMode.waiting"  [allowClear]="false">
                                        <button class="btn btn-sm btn-primary" (click)="remove(client, 'policyHolders');refreshHoldersPerCountry();" [desactive]="enableMode(stepName)"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                        <button *ngIf="last" class="btn btn-sm btn-primary" (click)="showAdditionalPH=true" [desactive]="mode"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                    </search-client> 
                                </div>                            
                            </div>
                            <div class="row" *ngIf="enablePolicyHolderRole()">
                                <div class="policyholder-cb col-md-offset-1 checkbox">
                                    <label class="checkbox-inline" *ngIf="policyHolderActivationFlag.activatedUsufructuary"> 
                                        <input type="checkbox" name="usufructuary" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.usufructuary"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                        <span class="cb-caption">Usufructuary</span>
                                    </label>                            
                                    <label class="checkbox-inline" *ngIf="policyHolderActivationFlag.activatedBareOwner">
                                        <input type="checkbox" name="bareOwner" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.bareOwner"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                        <span class="cb-caption">Bare Owner</span>
                                    </label>
                                    <label class="checkbox-inline" *ngIf="policyHolderActivationFlag.activatedSuccessionDeath"> 
                                        <input type="checkbox" name="deathSuccessor" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.deathSuccessor"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                        <span class="cb-caption">{{product.nlCountry!='FRA'  ? 'Legalheirs':'Succession'}} (death)</span>
                                    </label>
                                    <label class="checkbox-inline" *ngIf="policyHolderActivationFlag.activatedSuccessionLife || term == year_term"> 
                                        <input type="checkbox" name="lifeSuccessor" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.lifeSuccessor"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                        <span class="cb-caption">{{product.nlCountry!='FRA' ? 'Legalheirs':'Succession'}} (life)</span>
                                    </label>     
                                </div>
                            </div> 
                        </div> 
                    </div>              
                </ng-template>
                <div class="col-xs-12 nopadding" *ngIf="( !a.policyHolders || a.policyHolders.length==0 || showAdditionalPH)">
                    <label  class="marginTop col-md-2 text-right">Policyholder ({{ a.policyHolders ? a.policyHolders.length+1 : 1 }})</label>
                    <div class="form-group col-md-10 nopadding form-inline">
                        <div class="col-md-8">
                            <search-client [includeDeceased]="false" [(clientId)]="tmp_PH" (onChange)="tmp_PH=null;addPolicyHolder($event,'PH')" [disabled]="enableFor(stepName,[stateMode.readonly, stateMode.waiting])" [allowClear]="false"></search-client> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row client" *ngIf="product.isNotCapi"> <!-- INS = Insureds-->
            <div class="insured">
                <ng-template ngFor let-client [ngForOf]="a.insureds" let-i="index" let-last="last">
                    <div class="col-xs-12 nopadding">
                        <label class="insured-caption marginTop col-md-2 text-right">
                            <div class="inline-block marginTop">Insured ({{i+1}})</div>
                            <div class="checkbox pull-left" *ngIf="a.policyHolders[i]">
                                <label >(<input type="checkbox" [desactive]="mode" (change)="updateInsureds(i, $event)" [checked]="a.insureds[i].clientId==a.policyHolders[i].clientId"><span class="cr"><i class="cr-icon">&#x2714;</i></span>=holder{{i+1}})</label>
                            </div>   
                        </label>
                        <div class="form-group col-md-10 form-inline text-left" >
                            <div class="row">
                                <div class="col-md-8">
                                    <search-client [includeDeceased]="false" type="1" [(clientId)]="client.clientId" [disabled]="mode =='readOnly' || mode =='waiting'" [allowClear]="false">
                                        <button class="btn btn-sm btn-primary" (click)="remove(client, 'insureds')" [desactive]="mode"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                        <button *ngIf="last" class="btn btn-sm btn-primary" (click)="showAdditionalINS=true" [desactive]="mode"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                    </search-client> 
                                </div>
                            </div>
                        </div>
                    </div>              
                </ng-template>
                <div class="col-xs-12 nopadding" *ngIf="( !a.insureds || a.insureds.length==0 || showAdditionalINS)">
                    <label class="marginTop col-md-2 text-right">Insured ({{a.insureds ? a.insureds.length+1 : 1}})
                        <div class="checkbox pull-left" *ngIf="a.policyHolders[a.insureds ? a.insureds.length : 0]">
                            <label >(<input type="checkbox" [desactive]="mode" (change)="updateInsureds(-1, $event)" [checked]="false"><span class="cr"><i class="cr-icon">&#x2714;</i></span>=holder{{a.insureds.length+1}})</label>
                        </div>  
                    </label>
                    <div  class="form-group nopadding col-md-10 form-inline">
                        <div class="col-md-8">
                            <search-client [includeDeceased]="false" type="1" [(clientId)]="tmp_INS" (onChange)="tmp_INS=null;addInsureds($event,'INS');" [disabled]="mode =='readOnly' || mode =='waiting'" [allowClear]="false"></search-client> 
                        </div>
                    </div>
                </div>
            </div>        
        </div>

        <!-- Lives -->
        <div class="row" *ngIf="product.isNotCapi">
            <label class="marginTop col-xs-2 text-right">Lives</label>
            <div class="col-xs-10 nopadding form-inline">
                <select class="form-control input-sm" [(ngModel)]="a.lives" [desactive]="mode" [disabled]="disabledLives" (change)="checkBuisnessRules()">
                    <option value=""></option>
                    <option *ngFor="let c of livesList" [ngValue]="c.number">{{c.description}}</option>
                </select>           
            </div>
        </div>    
        <div class="col-xs-12 line-break-big"></div>

        <!--Beneficiary of death benefit-->
        <div class="client" *ngIf="product.isNotCapi">
            <ng-template ngFor let-client [ngForOf]="a.deathBeneficiaries" let-i="index" let-last="last">
                <div class="row death">
                    <label class="marginTop col-md-2 text-right paddingLeft"> Beneficiary of death ({{i+1}})</label>
                    <div class="death-form-group col-md-10 form-inline text-left">
                        <div class="row"> 
                            <div class="col-md-8 form-group">
                                <search-client [includeDeceased]="false" [(clientId)]="client.clientId" [disabled]="enableFor(stepName,[stateMode.readonly, stateMode.waiting])" [allowClear]="false">
                                    <button class="btn btn-sm btn-primary" (click)="remove(client, 'deathBeneficiaries')" [desactive]="enableMode(stepName)"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                    <button *ngIf="last" class="btn btn-sm btn-primary" (click)="showAdditionalDEA=true" [desactive]="enableMode(stepName)"><i class="fa fa-plus" aria-hidden="true"></i></button>
                            </search-client> 
                            </div> 
                            <div class="col-md-4">
                                <div class="death-input-group form-group">
                                    <label>Rank</label>
                                    <w-number [(number)]="client.rankNumber" (numberChange)="onDeathBenefRankChange(client)" css="rankWidth form-control input-sm text-right" [precision]="0" [mode]="enableMode(stepName)" ></w-number>
                                    <span class="checkbox checkbox-r" *ngIf="client.canShowEqualParts">
                                        <label>
                                            <input name="equalPart" type="checkbox" [desactive]="enableMode(stepName)" [checked]="client.isEqualParts" [(ngModel)]="client.isEqualParts" (change)="onDeathBenefEqualPartChange(client)">
                                            <span class="cr"><i class="cr-icon">&#x2714;</i></span> 
                                            In equal parts
                                        </label>
                                    </span>
                                    <label>Part</label>
                                    <w-number  [(number)]="client.split" css="form-control input-sm text-right input-percent" [precision]="3" [mode]="client.partMode" ></w-number><span>%</span>
                                </div>
                            </div>                   
                        </div>
                        <div class="row"> 
                            <div class="death-cb col-md-offset-1 checkbox" *ngIf="benefActivationFlag">
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedBenefUsuFructary"> 
                                    <input type="checkbox" name="usufructuary" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.usufructuary"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Usufructuary</span>
                                </label>                            
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedBenefBareOwner">
                                    <input type="checkbox" name="bareOwner" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.bareOwner"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Bare Owner</span>
                                </label>                            
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedIrrevocable"> 
                                    <input type="checkbox" name="irrevocable" class="input-sm" [(ngModel)]="client.irrevocable" (change)="refreshHideCodes()" [desactive]="enableMode(stepName)"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Irrevocable</span>
                                </label>
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedAcceptant"> 
                                    <input type="checkbox" name="acceptant" class="input-sm" [(ngModel)]="client.acceptant" (change)="refreshHideCodes()" [desactive]="enableMode(stepName)"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Acceptant</span>
                                </label>                            
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedSeparatePropertyRights"> 
                                    <input type="checkbox" name="seppropsrights" class="input-sm" [(ngModel)]="client.separatePropertyRights" [desactive]="enableMode(stepName)" (change)="client.separatePropertyNoRights=false"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Separate property Rights</span>
                                </label>
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedSeparatePropertyNoRights"> 
                                    <input type="checkbox" name="seppropsnorights" class="input-sm" [(ngModel)]="client.separatePropertyNoRights" [desactive]="enableMode(stepName)" (change)="client.separatePropertyRights=false"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Separate property NO Rights</span>
                                </label>                       
                            </div>               
                        </div>
                    </div>
                </div>                
            </ng-template>
            <div class="row" *ngIf="( !a.deathBeneficiaries || a.deathBeneficiaries.length==0 || showAdditionalDEA)">
                <label class="marginTop col-md-2 text-right paddingLeft">Beneficiary of death ({{a.deathBeneficiaries ? a.deathBeneficiaries.length+1 : 1}})</label>
                <div class="form-group col-md-10 nopadding form-inline">
                    <div class="col-md-8">  
                        <search-client [includeDeceased]="false" [(clientId)]="tmp_DEA" (onChange)="tmp_DEA=null;addDeathBeneficiaries($event,'DEA');" [disabled]="enableFor(stepName,[stateMode.readonly, stateMode.waiting])" [allowClear]="false"></search-client> 
                    </div>
                </div>
            </div>
        </div>

        <!--Beneficiary of maturity benefit-->
        <div class="client" *ngIf="canShowBeneficiaryLife(product, term)">   <!--  && product.isNotCapi  (added the 21/09/2017: Bug PROD Analysis	Produit Capi, pas de bénéficiaire maturity ni clauses maturity (attention à la validation) )  -->
            <ng-template ngFor let-client [ngForOf]="a.lifeBeneficiaries" let-i="index" let-last="last">
                <div class="row maturity">
                    <label class="marginTop col-md-2 text-right paddingLeft"> Beneficiary of maturity ({{i+1}})</label>
                    <div class="maturity-form-group col-md-10 form-inline text-left">
                        <div class="row"> 
                            <div class="col-md-8 form-group">
                                <search-client [includeDeceased]="false" [(clientId)]="client.clientId" [disabled]="enableFor(stepName,[stateMode.readonly, stateMode.waiting])" [allowClear]="false">
                                    <button class="btn btn-sm btn-primary" (click)="remove(client, 'lifeBeneficiaries')" [desactive]="enableMode(stepName)"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                    <button *ngIf="last" class="btn btn-sm btn-primary" (click)="showAdditionalMAT=true" [desactive]="enableMode(stepName)"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                </search-client> 
                            </div> 
                            <div class="col-md-4">
                                <div class="maturity-input-group form-group">
                                    <label>Rank</label>
                                    <w-number  [(number)]="client.rankNumber" (numberChange)="onLifeBenefRankChange(client)" css="rankWidth form-control input-sm text-right" [precision]="0" [mode]="enableMode(stepName)" ></w-number>
                                    <span class="checkbox checkbox-r" *ngIf="client.canShowEqualParts">
                                        <label>
                                            <input name="equalPart" type="checkbox" [desactive]="enableMode(stepName)" [checked]="client.isEqualParts" [(ngModel)]="client.isEqualParts" (change)="onLifeBenefEqualPartChange(client)">
                                            <span class="cr"><i class="cr-icon">&#x2714;</i></span> 
                                            In equal parts
                                        </label>
                                    </span>
                                    <label>Part</label>
                                    <w-number  [(number)]="client.split" css="form-control input-sm text-right input-percent" [precision]="3" [mode]="client.partMode" ></w-number><span>%</span>
                                </div>
                            </div>                   
                        </div>
                        <div class="row">  
                            <div class="maturity-cb col-md-offset-1 checkbox" *ngIf="benefActivationFlag">
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedBenefUsuFructary"> 
                                    <input type="checkbox" name="usufructuary" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.usufructuary"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Usufructuary</span>
                                </label>                            
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedBenefBareOwner">
                                    <input type="checkbox" name="bareOwner" class="input-sm" [desactive]="enableMode(stepName)" [(ngModel)]="client.bareOwner"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Bare Owner</span>
                                </label>
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedIrrevocable"> 
                                    <input type="checkbox" name="irrevocable" class="input-sm" [(ngModel)]="client.irrevocable" (change)="refreshHideCodes()" [desactive]="enableMode(stepName)"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Irrevocable</span>
                                </label>
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedAcceptant"> 
                                    <input type="checkbox" name="acceptant" class="input-sm" [(ngModel)]="client.acceptant" (change)="refreshHideCodes()" [desactive]="enableMode(stepName)"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Acceptant</span>
                                </label> 
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedSeparatePropertyRights"> 
                                    <input type="checkbox" name="seppropsrights" class="input-sm" [(ngModel)]="client.separatePropertyRights" [desactive]="enableMode(stepName)"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Separate property Rights</span>
                                </label>
                                <label class="checkbox-inline" *ngIf="benefActivationFlag.activatedSeparatePropertyNoRights"> 
                                    <input type="checkbox" name="seppropsnorights" class="input-sm" [(ngModel)]="client.separatePropertyNoRights" [desactive]="enableMode(stepName)"><span class="cr"><i class="cr-icon">&#x2714;</i></span>
                                    <span class="cb-caption">Separate property NO Rights</span>
                                </label>                         
                            </div>               
                        </div>
                    </div>
                </div>                
            </ng-template>
            <div class="row" *ngIf="( !a.lifeBeneficiaries || a.lifeBeneficiaries.length==0 || showAdditionalMAT)">
                <label class="marginTop col-md-2 text-right paddingLeft">Beneficiary of maturity ({{a.lifeBeneficiaries ? a.lifeBeneficiaries.length+1 : 1}})</label>
                <div class="form-group col-md-10 nopadding form-inline">
                    <div class="col-md-8">  
                        <search-client [includeDeceased]="false" [(clientId)]="tmp_MAT" (onChange)="tmp_MAT=null;addlifeBeneficiaries($event,'MAT');" [disabled]="enableFor(stepName,[stateMode.readonly, stateMode.waiting])" [allowClear]="false"></search-client> 
                    </div>
                </div>
            </div>
        </div>

        <div class="line-break"></div>
        <div class="line-break"></div>

        <div class="row"> 
            <div class="col-md-4 col-md-offset-1">
                <button type="button" class="btn btn-xs btn-primary" (click)="addOtherClient('otherClients', null)" [desactive]="enableMode(stepName)"><i class="fa fa-plus" aria-hidden="true"></i>Add other Relationships</button>                    
            </div>      
        </div>
        <div class="line-break-big"></div>
        <!--other relationships-->
        <div class="row client">        
            <ng-template ngFor let-otherCli [ngForOf]="a.otherClients" let-i="index" let-last="last">
                <div class="col-md-4 col-md-offset-1 paddingTop">
                    <select class="form-control input-sm text-left" [(ngModel)]="otherCli.clientRelationTp" (change)="refreshHideCodes();" [desactive]="enableMode(stepName)" aria-placeholder="Role">
                        <option value=""></option>
                        <option *ngFor="let role of CPRRoleList | orderBy : ['description']" [value]="role.number">{{role.description}}</option>
                    </select>
                </div>
                <div class="col-md-5 marginTop nopadding">
                    <!-- TODO : this mess should be refactored, calling a method such as enableMode all over this template is unacceptable! -->
                    <search-client [(clientId)]="otherCli.clientId" [desactive]="enableMode(stepName)" [disabled]="enableMode(stepName) === stateMode.readonly || enableMode(stepName) === stateMode.waiting" [allowClear]="false">
                        <button class="btn btn-sm btn-primary" (click)="removeIndex(i, 'otherClients')" [desactive]="enableMode(stepName)"><i class="fa fa-minus" aria-hidden="true"></i></button>
                    </search-client> 
                </div>
                <div class="col-md-2 marginTop" *ngIf="isSurrRightsCessionary(otherCli)"> 
                    <div class="row">
                        <div class="form-inline">                    
                            <div class="form-group">                    
                                <label for="">Max</label>
                                <w-number  [(number)]="otherCli.split" css="form-control input-sm text-right input-percent" [precision]="3" [mode]="mode" ></w-number><span>%</span>
                            </div>
                        </div> 
                    </div>                              
                </div> 
            </ng-template>
        </div>
    </section>

    <div class="row" *ngIf="product.isNotCapi || showBenefLifeClause"> <!--  term=='YEAR_TERM'  removed before now only non capi product should show the clause.-->
        <div class="title col-md-6 col-md-offset-1">Clauses</div>
    </div>

    <section id="DeathClause" *ngIf="product.isNotCapi">
        <!--Rank / Type / Death Clause-->
        <div>
            <div class="row" >
                <div class="col-xs-1 col-md-offset-1">
                    <label>Rank</label>
                </div>
                <div class="col-xs-1 ">
                    <label>Type</label>
                </div>
                <div class="col-xs-5 ">
                    <label>Death Clauses</label>
                </div>
            </div>
            <div class="row client marginBottom" *ngFor="let clause of a.deathBenefClauseForms; let i=index;let last=last"  >
                    <div class="col-xs-1 col-md-offset-1">
                        <w-number  [(number)]="clause.rankNumber" css="form-control input-sm text-right input-percent" [precision]="0" [mode]="enableMode(stepName)" ></w-number>
                    </div>
                    <div class="col-xs-1 nopadding">          
                        <select class="form-control input-sm text-left" [(ngModel)]="clause.clauseTp" [desactive]="enableMode(stepName)" (change)="onClauseTypeChange(clause)">
                            <option value=""></option>
                            <option *ngFor="let type of clauseTypeList" [ngValue]="type">{{type}}</option>
                        </select>
                    </div>
                    <div class="col-xs-8 paddingHorizontal2">      
                        <select *ngIf="(clause.clauseTp=='Standard' && !(clauseTypeList.indexOf('Standard')<0))" class="form-control input-sm text-left" [(ngModel)]="clause.clauseCd" [desactive]="enableMode(stepName)">
                            <option value=""></option>
                            <option *ngFor="let clauseStd of benefClauseStdList" [ngValue]="clauseStd.benefClauseCd">{{clauseStd.benefClauseText}}</option>
                        </select>
                        <textarea *ngIf="clause.clauseTp=='Free' || clauseTypeList.indexOf('Standard')<0" autosize class="form-control paddingVertical" [(ngModel)]='clause.clauseText' rows="1" [desactive]="enableMode(stepName)"> </textarea>
                    </div>
                    <div class="col-xs-1 nopadding">
                        <button *ngIf="a.deathBenefClauseForms.length>1 || clause.benefClauseFormId" class="btn btn-sm btn-primary" (click)="removeClose(i, 'deathBenefClauseForms','D')" [desactive]="enableMode(stepName)"><i class="fa fa-minus" aria-hidden="true"></i></button>
                        <button *ngIf="last" type="button" class="btn btn-sm btn-primary" (click)="addClause('deathBenefClauseForms','D')" [desactive]="enableMode(stepName)"><i class="fa fa-plus" aria-hidden="true"></i></button>                    
                    </div>
            </div>
        </div>
    </section>

    <section id="LifeClause" *ngIf="showBenefLifeClause"> <!--  && product.isNotCapi  (added the 21/09/2017: Bug PROD Analysis	Produit Capi, pas de bénéficiaire maturity ni clauses maturity (attention à la validation) )  -->
        <div class="line-break"></div>
        <div > 
            <!--Rank / Type / Life Clause-->
            <div class="row">
                <div class="col-xs-1 col-md-offset-1">
                    <label>Rank</label>
                </div>
                <div class="col-xs-1 ">
                    <label>Type</label>
                </div>
                <div class="col-xs-5 ">
                    <label>Life Clauses</label>
                </div>
            </div>
            <div class="row client marginBottom" *ngFor="let clause of a.lifeBenefClauseForms; let i=index;let last=last">
                <div class="col-xs-1 col-md-offset-1">
                    <w-number  [(number)]="clause.rankNumber" css="form-control input-sm text-right input-percent" [precision]="0" [mode]="enableMode(stepName)" ></w-number>
                </div>
                <div class="col-xs-1 nopadding">          
                    <select class="form-control input-sm text-left" [(ngModel)]="clause.clauseTp" [desactive]="enableMode(stepName)" (change)="onClauseTypeChange(clause)">
                        <option *ngFor="let type of clauseTypeList" [ngValue]="type">{{type}}</option>
                    </select>
                </div>
                <div class="col-xs-8 paddingHorizontal2">       
                    <select *ngIf="(clause.clauseTp=='Standard' && !(clauseTypeList.indexOf('Standard')<0))" class="form-control input-sm text-left" [(ngModel)]="clause.clauseCd" [desactive]="enableMode(stepName)">
                        <option value=""></option>
                        <option *ngFor="let clauseStd of benefClauseStdList" [ngValue]="clauseStd.benefClauseCd">{{clauseStd.benefClauseText}}</option>
                    </select>
                    <textarea *ngIf="clause.clauseTp=='Free' || clauseTypeList.indexOf('Standard')<0" autosize class="form-control paddingVertical" [(ngModel)]='clause.clauseText' rows="1" [desactive]="enableMode(stepName)"> </textarea>    
                </div>
                <div class="col-xs-1 nopadding">
                    <button *ngIf="a.lifeBenefClauseForms.length>1 || clause.benefClauseFormId" class="btn btn-sm btn-primary" (click)="removeClose(i, 'lifeBenefClauseForms','L')" [desactive]="enableMode(stepName)"><i class="fa fa-minus" aria-hidden="true"></i></button>
                    <button *ngIf="last" type="button" class="btn btn-sm btn-primary" (click)="addClause('lifeBenefClauseForms','L')" [desactive]="enableMode(stepName)"><i class="fa fa-plus" aria-hidden="true"></i></button>                    
                </div>   
            </div>
        </div>
    </section>

    <!--Communication & specificities-->
    <section subject="communication-and-specificities">
        <div class="row">
            <div class="title col-md-6 col-md-offset-1">Communication & specificities</div>
        </div>
        <div class="row">
            <div class="form-inline">
                <div class="">
                    <label class="control-label col-md-2 text-right marginTop">Sending Rules</label>
                    <div class="form-group col-md-3">
                        <select class="form-control input-sm" [(ngModel)]="a.sendingRules" [desactive]="enableMode(stepName)" (change)="checkMail2Agent()">
                            <option value=""></option>
                            <option *ngFor="let c of sendingRuleList" [ngValue]="c.keyValue">{{c.description}}</option>
                        </select>
                    </div> 
                    <label class="marginTop col-md-2 text-right" *ngIf="showMail2Agent">Mail to Agent</label>
                    <div class="form-group col-md-3 form-inline" *ngIf="showMail2Agent">
                        <select class="form-control input-sm" [(ngModel)]="a.mailToAgent" [desactive]="enableMode(stepName)">
                            <option value=""></option>
                            <option *ngFor="let a of mail2AgentList" [ngValue]="a.agtId">{{a.name}} [<agt-label [categoryCode]="a.category"></agt-label>]</option>
                        </select>
                    </div> 
                </div>
            </div>
        </div>
        <div class="line-break-thin"></div>
        <div class="row">
            <div class="form-horizontal">
                <div class="col-md-8">
                    <label class="control-label col-md-5">Order by FAX</label>
                    <div class="radio col-md-5 nopadding">
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="orderByFax"  [value]="true" [checked]="a.orderByFax==true" [(ngModel)]="a.orderByFax">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            Yes
                        </label>
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="orderByFax" [value]="false" [checked]="a.orderByFax==false" [(ngModel)]="a.orderByFax">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            No
                        </label>                                                
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-horizontal">
                <div class="col-md-8">
                    <label class="control-label col-md-5">Mandate of transmission except broker</label>
                    <div class="radio col-md-5 nopadding">
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="mandate"  [value]="true" [checked]="a.mandate==true" [(ngModel)]="a.mandate">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            Yes
                        </label>
                        <label class="radio-inline">
                            <input class="form-control input input-sm"  [desactive]="enableMode(stepName)" type="radio" name="mandate"  [value]="false" [checked]="a.mandate==false" [(ngModel)]="a.mandate">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            No
                        </label>                                                
                    </div>
                </div>
            </div>
        </div>
        

        <div class="line-break-thin"></div>
        <div class="row" *ngIf="nbHoldersPerCountry.ESP || nbHoldersPerCountry.ITA">
            <label class="marginTop col-md-2 text-right" ><span *ngIf="nbHoldersPerCountry.ESP">Non-Surrender Clause Date</span></label>
            <div class="form-group col-md-2" >
                <datepicker *ngIf="nbHoldersPerCountry.ESP" [(date)]="a.nonSurrenderClauseDt" [disabled]="mode=='readOnly' || mode == 'waiting'"></datepicker>
            </div>    
            <div class="form-group col-md-3 col-md-offset-2 paddingLeft" *ngIf="nbHoldersPerCountry.ITA">
                <label class="checkbox-inline" > 
                        <input type="checkbox" class="input-sm" [desactive]="mode" [(ngModel)]="a.mandatoAllincasso"><span class="cr"><i class="cr-icon">&#x2714;</i></span>Mandato all'incasso 
                </label>
            </div> 
            <div class="form-group col-md-3" *ngIf="nbHoldersPerCountry.ITA">
                <label class="checkbox-inline marginLeft" > 
                        <input type="checkbox" class="input-sm" [desactive]="mode" [(ngModel)]="a.scudo"><span class="cr"><i class="cr-icon">&#x2714;</i></span>Scudo 
                </label>
            </div> 
        </div>
        <div class="row" *ngIf="nbHoldersPerCountry.BEL">
            <label class="marginTop col-md-2 text-right"><span >Taxe</span></label>
            <div class="form-group col-md-2 form-inline">
                <span><w-number [(number)]="a.taxRate" css="form-control input-sm text-right input-percent" [precision]="6" [mode]="mode" ></w-number>%</span>
            </div>  
        </div>
    </section>

    <!--Death coverage-->
    <section subject="death-coverage">
        <div class="row">
            <div class="title col-md-6 col-md-offset-1" *ngIf="product.isNotCapi">Death coverage</div>
        </div>
        <div class="row" *ngIf="product.isNotCapi">
            <div class="col-xs-6 nopadding">
                <div class="col-md-8 col-md-offset-4 radio">
                    <label class="radio-inline marginLeft" >
                        <input type="radio" name="deathCoverageStd" [value]="true" [disabled]="disableDeathCoverage" [desactive]="mode" [(ngModel)]="a.deathCoverageStd" (ngModelChange)="changeCoverageStd()"><span class="cr"><i class="cr-icon fa fa-circle"></i></span>Standard
                    </label>
                    <label class="radio-inline marginLeft" > 
                        <input type="radio" name="deathCoverageStd" [value]="false" [disabled]="disableDeathCoverage" [desactive]="mode" [(ngModel)]="a.deathCoverageStd" (ngModelChange)="changeCoverageStd()"><span class="cr"><i class="cr-icon fa fa-circle"></i></span>Alternative
                    </label>
                </div>
            </div>

            <div class="col-xs-6" *ngIf="deathCoverageClauses">            
                <div [hidden]="a.deathCoverageStd">
                    <div class="row radio" *ngFor="let DCClause of deathCoverageClauses.alternativeClauses">
                        <label class="radio-inline marginLeft" >
                                <input type="radio" name="alternativeCoverage" [value]="'ALT-'+DCClause.deathCoverageTp" [checked]="(DCClause.deathCoverageTp==a.deathCoverageTp && a.deathCoverageStd==false)" [desactive]="mode" (change)="changeCoverageTp($event.target.checked, DCClause)"><span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                                {{DCClause.clause.split('[')[0]}}
                            <ng-container [ngSwitch]="DCClause.inputType">
                                    <w-number *ngSwitchCase="'PERCENTAGE'" [disabled]="a.deathCoverageTp!=DCClause.deathCoverageTp || !DCClause.updatable" [number]="DCClause.defaultValue" css="form-control input-sm text-right input-percent" [precision]="6" [mode]="mode" (numberChange)="changeCoverageValue($event, DCClause)"></w-number>
                                    <w-number *ngSwitchCase="'AMOUNT'" [disabled]="a.deathCoverageTp!=DCClause.deathCoverageTp || !DCClause.updatable"  [number]="DCClause.defaultValue" css="form-control input-sm text-right input-amount" [mode]="mode" (numberChange)="changeCoverageValue($event, DCClause)"></w-number>
                            </ng-container>
                            {{DCClause.clause.split(']').length>1?DCClause.clause.split(']')[1]:''}}
                        </label> 
                        <div class="line-break"></div>          
                    </div>
                </div>
            
            </div>
        </div>
    </section>

    <!--Investment-->
    <ng-container *ngIf="!isGenerateMandateStep()">
        <div class="row">
            <analysis-invest class="col-md-12" [(fundForms)]="a.fundForms" 
                            [stepName]="stepName"
                            [valuationDate]="a.paymentDt"
                            [formId]="a.formId" 
                            [broker]="a.broker" 
                            [mode]="mode" 
                            [currency]="a.contractCurrency"
                            [totalInvestment] = "a.paymentAmt"
                            [generateMandatDeGestion]="canGenerateMandatDeGestionInStep(stepName)"
                            [showValuationAmount]="canShowValuationAmount(stepName)"
                            (fundFormsChange)="onChangeInvestment()" 
                            (generateMandateChange)="applyManagementMandateDocRequest($event)" ></analysis-invest>                
        </div>
    
        <div class="row">        
            <div class="row marginTop4" *ngIf="product?.nlCountry=='FRA' || product?.nlCountry=='LUX'">
                <div class="col-md-12">
                    <label class="control-label col-md-2">Cooling-off period</label>
                    <div class="radio col-md-5 nopadding">
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="noCoolOff"  [value]="false" [checked]="a.noCoolOff!=true" [(ngModel)]="a.noCoolOff">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            Yes
                        </label>
                        <label class="radio-inline">
                            <input class="form-control input input-sm"  [desactive]="enableMode(stepName)" type="radio" name="noCoolOff"  [value]="true" [checked]="a.noCoolOff==true" [(ngModel)]="a.noCoolOff">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            No
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!--Payment-->
        <section subject="payment">
            <div class="row">
                <div class="title col-md-6 col-md-offset-1">Payment</div>
            </div>
            <div class="row">
                <div class="form-horizontal">
                    <label for="" class="col-md-2 text-right marginTop ">Premium Country</label>
                    <div class="col-md-2">
                        <select class="form-control input-sm text-left" [(ngModel)]="a.premiumCountryCd" id="countryCd" name="countryCd" [desactive]="mode" [disableFor]="['readOnly']">
                            <option value=""></option>
                            <option *ngFor="let c of (allCountries | orderBy: ['name'])" [ngValue]="c.ctyId">{{c.name}}</option>
                        </select>	
                    </div>
                    <label class="control-label col-md-2">Re-invest</label>
                    <div class="radio col-md-2">
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="paymentTransfer"  [value]="true" [checked]="a.paymentTransfer==true" [(ngModel)]="a.paymentTransfer">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            Yes
                        </label>
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="paymentTransfer"  [value]="false" [checked]="a.paymentTransfer!=true" [(ngModel)]="a.paymentTransfer" (change)="a.policyTransferForms =[];">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            No
                        </label>                                                
                    </div>

                    <label class="control-label col-md-1">Transfer</label>
                    <div class="radio col-md-2">
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="policyTransfer" [value]="true" [checked]="a.policyTransfer==true" [(ngModel)]="a.policyTransfer">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            Yes
                        </label>
                        <label class="radio-inline">
                            <input class="form-control input input-sm" [desactive]="enableMode(stepName)" type="radio" name="policyTransfer" [value]="false" [checked]="a.policyTransfer!=true" [(ngModel)]="a.policyTransfer" (change)="a.policyTransferForms =[];">
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>
                            No
                        </label>                                                
                    </div>

                </div>
            </div>

            <!-- The policy  transfers -->
            <policy-transfer-input *ngIf="a.policyTransfer || a.paymentTransfer" 
                [(policyTransfers)]="a.policyTransferForms"
                [mode]="enableMode(stepName)"
            ></policy-transfer-input>

            <div class="row">
                <label for="" class="col-md-2 text-right marginTop">Amount</label>
                <div class="col-md-3 form-inline">
                    <w-number [(number)]="a.paymentAmt" css="form-control input-sm text-right input-amount" [mode]="mode!='waiting'?mode:'edit'" ></w-number><span>{{ a.contractCurrency }}</span>
                    <div *ngIf="a.paymentAmt && a.expectedPremium && a.paymentAmt!=a.expectedPremium" class="text-warning">&#9888;&nbsp;The amount differs from the expected premium</div>
                </div>
                <label for="" class="col-md-2 col-md-pull-1 text-right marginTop ">Date of Effect</label>
                <div class="col-md-3 col-md-pull-1">
                    <!-- TODO : to be mapped -->
                    <datepicker [disabled]="mode=='readOnly'" [(date)]="a.paymentDt" (dateChange)="updateValuationAmount($event)"></datepicker>
                </div>
            </div>
        </section>

    </ng-container>

    <div class="line-break-big"></div>
    <div class="line-break-big"></div>
</div>
</div>