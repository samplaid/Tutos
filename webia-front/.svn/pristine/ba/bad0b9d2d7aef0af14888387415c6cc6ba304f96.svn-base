<search-menu path='..'></search-menu>
<div class="line-break"></div>
<div class="fund-search">
    <div class="split-screen">
        <div class="form">            
            <form  novalidate>
                <div class="row">
                    <div class="col-md-2 radio paddingTop fund-sub-type">
                        <label class="radio-inline" *ngFor="let fundType of fundTypes, let i=index">
                            <input type="radio" name="fundType" id="{{ fundType + i }}" [value]="fundType" [(ngModel)]="frmFundSubType" [checked]="fundType == 'FID'"> 
                            <span class="cr"><i class="cr-icon fa fa-circle"></i></span>{{ fundType }}
                        </label>
                    </div>
                    <div class="col-md-3 fund-input-search">
                        <div class="form-inline">
                            <div class="form-group">
                                <label for="code" class="control-label paddingLeft3">Name/Code</label>
                                <input type="text" name="code" id="codeID" class="form-control input input-sm" [(ngModel)]="frmFilter" [autofocus]>
                            </div>
                            <div class="form-group" *ngIf="frmFundSubType=='FE'">
                                <label for="isin" class="control-label paddingLeft3">ISIN</label>
                                <input type="text" name="isin" id="isinID" class="form-control input input-sm" [(ngModel)]="frmIsinCode">
                            </div>
                            <div class="form-group" *ngIf="frmFundSubType=='FID' || frmFundSubType=='FAS'">
                                <label for="iban" class="control-label paddingLeft3">IBAN/Root Account</label>
                                <input type="text" name="iban" id="ibanID" class="form-control input input-sm" [(ngModel)]="frmIbanOrAccountRoot">
                            </div>                                                        
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label for="depositBank" class="col-md-5 control-label nomargin paddingTop">Custody Bank</label>
                                <div class="col-md-7">
                                    <search-agent [allowClear]="false" [(agentId)]="frmDepositBank" [type]="'DB'" ></search-agent>
                                </div>  
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-horizontal">
                            <div class="form-group">
                                <ng-container *ngIf="frmFundSubType=='FID'">
                                    <label for="assetManager" class="col-md-5 control-label nomargin paddingTop">Asset Manager</label>
                                    <div class="col-md-7">
                                        <search-agent [allowClear]="false" [(agentId)]="frmAssetManager" [type]="'AM'"></search-agent>                                         
                                    </div>
                                    <!--<input type="text" name="assetManager" id="assetManagerID" class="form-control input input-sm" [(ngModel)]="frmAssetManager">-->
                                </ng-container>
                                <ng-container *ngIf="frmFundSubType=='FAS'">
                                    <label for="financialAdvisor" class="col-md-5 nomargin paddingTop">Financial Advisor</label>
                                    <div class="col-md-7">
                                        <search-agent [allowClear]="false" [(agentId)]="frmFinancialAdvisor" [type]="financialAdvisorTypes" ></search-agent>
                                    </div>
                                </ng-container>
                            </div>
                        </div>                        
                    </div>                    
                    <div class="col-md-1">
                        <div class="checkbox checkbox-r">
                            <label>
                                <input name="status" class="input-sm form-control" type="checkbox" (change)="statusChange($event)" [checked]="frmStatus==1">
                                <span class="cr"><i class="cr-icon">&#x2714;</i></span> 
                                Active only
                            </label>
                        </div>
                    </div>
                    <div class="w-col-md-3">
                        <button class="btn btn-primary btn-xs" type="submit" (click)="search(1)"><span aria-hidden="true" class="glyphicon glyphicon-search"></span>Search</button>
                        <button class="btn btn-primary btn-xs" type="button" (click)="eraseFields()"><i class="fa fa-eraser" aria-hidden="true"></i> Clear</button> 
                    </div>
                    <div class="col-md-1 pull-right" *ngIf="page.totalRecordCount > 0">{{ page.totalRecordCount }} Result(s)</div>
                </div> <!--/ search criteria form-->
            </form>          

            <div class="row marginTop4 relative">
                <div class="col-md-12" [ngBusy]="[busy]">
                    <table class="table dataTable table-striped table-hover nomargin fullwidth" role="grid" *ngIf="page.content">
                        <thead>
                            <tr role="row">
                                <th class="tab-col-autosize">Code</th>
                                <th class="tab-col-autosize">Status</th>
                                <th>Name</th>
                                <th class="tab-col-autosize">Currency</th>
                                <th class="tab-col-autosize" *ngIf="fundSubType=='FE'">ISIN</th>
                                <th class="tab-col-autosize" *ngIf="fundSubType=='FID' || fundSubType=='FAS'">Account Root</th>
                                <th class="tab-col-autosize" *ngIf="fundSubType=='FID' || fundSubType=='FAS'">IBAN</th>
                                <th>Custody Bank</th>
                                <th *ngIf="fundSubType=='FID'">Asset Manager</th>
                                <th *ngIf="fundSubType=='FE'" class="tab-col-autosize">Broker</th>
                                <th *ngIf="fundSubType=='FE'" class="tab-col-autosize">Pricing frequency</th>
                                <th *ngIf="fundSubType=='FE'">Limit CAA</th>
                                <th class="tab-col-autosize" *ngIf="fundSubType=='FAS'">Financial Advisor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let fund of page.content; let i = index">
                                <td>
                                    <a [routerLink]="'/fund/'+ fund.fundSubType + '/' + encodeUri(fund.fdsId)" target="_blank"><span class="text-nowrap">{{ fund?.fdsId }}</span></a>
                                </td>                                
                                <td>
                                    <ng-container *ngIf="fund" [ngSwitch]="fund.status">
                                        <span *ngSwitchCase="0" class="label label-primary w-label">Pending</span>
                                        <span *ngSwitchCase="1" class="label label-primary w-label">Active</span>
                                        <span *ngSwitchCase="2" class="label label-primary w-label">Inactive</span>
                                        <span *ngSwitchDefault  class="label label-primary w-label"></span>
                                    </ng-container>
                                </td>
                                <td><span class="text-nowrap">{{ fund?.name }}</span></td>
                                <td class="text-center"><span class="text-nowrap">{{ fund?.currency }}</span></td>
                                <td *ngIf="fundSubType=='FE'"><span class="text-nowrap">{{ fund?.isinCode }}</span></td>
                                <td *ngIf="fundSubType=='FID' || fundSubType=='FAS'"><span class="text-nowrap">{{ fund?.accountRoot }}</span></td>
                                <td *ngIf="fundSubType=='FID' || fundSubType=='FAS'"><span class="text-nowrap">{{ fund?.iban }}</span></td>
                                <td>
                                    <span class="text-nowrap">{{  datastore[fund?.depositBank] }}</span>
                                </td>
                                 <td *ngIf="fundSubType=='FID'">
                                    <span class="text-nowrap">{{ datastore[fund?.assetManager] }}</span>
                                </td>
                                <td *ngIf="fundSubType=='FAS'">
                                    <span class="text-nowrap">{{ datastore[fund?.financialAdvisor] }}</span>
                                </td> 
                                <td *ngIf="fundSubType=='FE'">
                                    <span class="text-nowrap">{{ datastore[fund?.broker] }}</span>
                                </td> 
                                <td *ngIf="fundSubType=='FE'">
                                        <span class="text-nowrap">{{ toPricingDescription(fund?.pricingFrequency) }}</span>
                                    </td>
                                <td *ngIf="fundSubType=='FE'">
                                    <span class="text-nowrap">{{ fund?.limitCAA }}</span>
                                </td> 
                            </tr>
                            <tr *ngIf="noResult">
                                <td [colSpan]="noResultColSpan" class="text-center"><p style="padding: 300px">No result found </p></td>
                            </tr>
                        </tbody>
                        <tfoot *ngIf="!!page && page.totalPageCount > 1">
                            <tr>
                                <td colspan="10" class="text-center">
                     <!-- <ngb-pagination *ngIf="page.totalPageCount > 1" class="text-center" (pageChange)="search($event)" [collectionSize]="page.totalRecordCount"
                        [pageSize]="page.pageSize" [(page)]="page.currentPage" [maxSize]="10" [ellipses]="true" [boundaryLinks]="true"></ngb-pagination> -->

                                <pagination class="text-center" [boundaryLinks]="true" 
                                            [totalItems]="page.totalRecordCount" [itemsPerPage]="page.pageSize" [(ngModel)]="page.currentPage" (pageChanged)="search($event.page)" [maxSize]="10"
                                        previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;"></pagination>
                                </td>
                            </tr>
                        </tfoot>                          
                    </table>

                </div>
            </div> <!--/ result-->

            <div class="row marginTop4">
                <div class="col-md-12 text-center">
                    <button type="button" class="btn btn-xs btn-primary text-left" [hasRoles]="[ appRoles.FUND_FID_FAS_EDIT ]" (click)="createNewFund('FID')">New FID</button>
                    <button type="button" class="btn btn-xs btn-primary text-left" [hasRoles]="[ appRoles.FUND_FID_FAS_EDIT ]" (click)="createNewFund('FAS')">New FAS</button>   
                    <button type="button" class="btn btn-xs btn-primary text-left" [hasRoles]="[ appRoles.FUND_FE_FIC_EDIT ]" (click)="createNewFund('FE')">New FE</button>                          
                </div>
            </div> <!--/ creation new client-->
        </div> <!--/ form div-->
    </div>
</div>