<ng-template ngbModalContainer></ng-template>
<div class="split-screen relative">
    <div [ngBusy]="subs">
        <workflow-header [workflowName]="'Withdrawal'" [workflowItemId]="step?.workflowItemId" [workFlowStatus]="step?.workFlowStatus" [assignedTo]="step?.assignedTo"
            [polId]="step?.polId" [applicationForm]="step?.applicationForm" [productCd]="step?.productCd" [productName]="step?.productName"
            [secondCpsUser]="secondCpsUser" [firstCpsUser]="firstCpsUser" [rejectable]="step?.stepRejectable" [mode]="headerMode"
            [commentsData]="commentsData" [rejectsData]="rejectsData" (onSave)="save()" (onAbort)="abort()" (onNext)="next()"
            [canAbort]="step?.stepAbortable" (onReject)="reject()" (onAddStepComment)="addStepComment($event)">
                <ng-container ngProjectAs="additionnal-buttons">
                    <button class="btn btn-xs btn-default" (click)="printAcceptanceReport()" [desactive]="headerMode" *ngIf="canPrintAcceptanceReport">
                        <i class="fa fa-print" aria-hidden="true" ></i> Acceptance
                    </button>
                    <!-- Button for simulations of the accounting notes and the securities transfer-->
                    <div class="btn-group" dropdown *ngIf="isSimulationAmendmentAvailable || isSimulationAccountingNotesAvailable || isSimulationTitleTransfersAvailable || isSimulationInstructionsToAssetManagerAvailable">
                        <button id="button-basic" dropdownToggle type="button" class="btn btn-xs btn-primary dropdown-toggle" aria-controls="dropdown-basic">
                            <i class="fa fa-file-pdf-o" aria-hidden="true"></i> Simulation <span class="caret"></span>
                        </button>
                        <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-basic">
                            <li role="menuitem" *ngIf="isSimulationAmendmentAvailable">
                                <a class="dropdown-item clickable" (click)="simulate('WITHDRAWAL')">Endorsement</a>
                            </li>
                            <li role="menuitem" *ngIf="isSimulationAccountingNotesAvailable">
                                <a class="dropdown-item clickable" (click)="simulate('WITHDRAWAL_ACCOUNTING_NOTE')">Accounting notes</a>
                            </li>
                            <li role="menuitem" *ngIf="isSimulationTitleTransfersAvailable">
                                <a class="dropdown-item clickable" (click)="simulate('FAX_SECURITIES_TRANSFER')">Securities transfer</a>
                            </li>
                            <li role="menuitem" *ngIf="isSimulationInstructionsToAssetManagerAvailable">
                                <a class="dropdown-item clickable" (click)="simulateInstructionsToAssetManagerDocuments()">Instructions to Asset Manager</a>
                            </li>
                        </ul>
                    </div>

                </ng-container>
        </workflow-header>

        <div class="row">
            <div class="col-xs-7 form-horizontal" [ngClass]="{'col-xs-6' : (viewSimulation || viewInstructionsToAssetManagerSimulations), 'col-xs-7' : !(viewSimulation || viewInstructionsToAssetManagerSimulations)}">
                <withdrawal-analysis *ngIf="step?.formData"
                    [usersList]="usersList"
                    [transferCandidates]="transferCandidates"
                    [(form)]="step.formData"
                    [stepName]="step?.stepWorkflow"
                    [workflowItemId] = "step?.workflowItemId"
                    [policyIdDisabled] = "!!step?.polId"
                    [mode]="formsMode"
                    [paymentsMode]="paymentsMode"
                    (onAddPayment)="addCashTransfer()">
                </withdrawal-analysis>
            </div>
                
            <div class="paddingLeft" [ngClass]="{'col-xs-6' : (viewSimulation || viewInstructionsToAssetManagerSimulations), 'col-xs-5 paddingLeft' : !(viewSimulation || viewInstructionsToAssetManagerSimulations)}">
                <div *ngIf="!viewSimulation && !viewInstructionsToAssetManagerSimulations" [@enterAnimation]>
                    <survey
                        [inputData]="step?.checkSteps" 
                        [workflowItemId]="step?.workflowItemId" 
                        [stepWorkflow]="step?.stepWorkflow" 
                        [mode]="surveyMode">
                    </survey>
                </div>                
                <div *ngIf="viewSimulation" [@enterAnimation]>
                    <simulation
                        [loadObservable]="simulationObservable" 
                        (onRefresh)="refresh()"
                        (onClose)="onSimulationClose()">
                    </simulation>
                </div>
                <div *ngIf="viewInstructionsToAssetManagerSimulations" [@enterAnimation]>
                    <multiple-simulations
                        (onClose)="closeInstructionsToAssetManager()"
                        (onRefresh)="simulateInstructionsToAssetManagerDocuments()"
                        [editingRequests]="enoughCashEditingRequests">
                    </multiple-simulations>
                </div>
            </div>
        </div>
    </div>
</div>