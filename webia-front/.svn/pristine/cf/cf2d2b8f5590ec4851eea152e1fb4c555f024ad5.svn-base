<div class="row">
    <div class="col-md-1 text-right">
        <button class="btn btn-nav" id="previous" (click)="reject()" [disabled]="!rejectable || workFlowStatus === 3 || workFlowStatus === 4" [desactive]="mode" title="Reject step">
            <i class="fa fa-chevron-left" aria-hidden="true"></i>
            <i class="fa fa-chevron-left" aria-hidden="true"></i>
        </button>
    </div>
    <div class="col-md-10 menu">
        <div class="col-md-1 nopadding">
            <img alt="Wealins" src="./assets/img/wealins-logo-flat.png" class="pull-left marginTop" width="120">
        </div>
        <div class="col-md-2 marginTop3">
            <div class="row">
                <div class="form-inline">
                    <label>
                        <b>{{workflowName}}</b>
                    </label>
                    <span>{{workflowItemId}}</span>
                    <span class="paddingLeft10">
                        <span class="label label-primary w-label" *ngIf="workFlowStatus === 1">Active</span>
                        <span class="label label-primary w-label" *ngIf="workFlowStatus === 2">Suspended</span>
                        <span class="label label-primary w-label" *ngIf="workFlowStatus === 3">Completed</span>
                        <span class="label label-primary w-label" *ngIf="workFlowStatus === 4">Ended</span>
                        <span class="label label-primary w-label" *ngIf="workFlowStatus === 5">Locked</span>
                    </span>
                </div>
            </div>
            <div class="row" *ngIf="firstCpsUser">
                <label>
                    <b>CPS 1</b>
                </label> {{firstCpsUser.name0}}
            </div>
        </div>
        <div *ngIf="polId" class="col-md-2 marginTop3">
            <div class="row">
                <label>
                    <b>Policy</b>
                </label>
                <a href="./#/policy?id={{polId}}" target="_blank">{{polId}}</a>
            </div>
            <div class="row" *ngIf="secondCpsUser">
                <label>
                    <b>CPS 2</b>
                </label> {{secondCpsUser.name0}}
            </div>
        </div>
        <div class="col-md-2 marginTop3">
            <div class="row" *ngIf="applicationForm">
                <label><b>Application Nr</b></label> {{applicationForm}}
            </div>
            <div class="row" *ngIf="assignedTo">
                <label>
                    <b>Assigned to</b>
                </label> {{assignedTo}}
            </div>
        </div>

        <div class="col-md-2 marginTop3">
            <div>{{productCd}} {{productName}}</div>
        </div>
        <div class="pull-right col-md-3 paddingVertical2 paddingLeft text-right">
            <button class="btn btn-xs btn-default" (click)="addComment()">
                <i class="fa fa-comments-o" aria-hidden="true"></i> Comment
            </button>
            <ng-container *ngIf="workFlowStatus !== 3 && workFlowStatus !== 4">
                <ng-content select="additionnal-buttons"></ng-content>
                <button class="btn btn-xs btn-primary" (click)="save()" [desactive]="mode">
                    <i class="fa fa-floppy-o" aria-hidden="true"></i> Save
                </button>
                <button *ngIf="canAbort" class="btn btn-xs btn-default" (click)="abort()" [desactive]="mode">
                    <i class="fa fa-trash" aria-hidden="true" ></i> Abort
                </button>
            </ng-container>
            <ng-content select="additionnal-buttons-always-shown"></ng-content>          
        </div>
    </div>
    <div class="col-md-1">
        <button class="btn btn-nav" id="next" (click)="next()" title="Finalise step" [disabled]="workFlowStatus === 3 || workFlowStatus === 4" [desactive]="mode">
            <i class="fa fa-chevron-right" aria-hidden="true"></i>
            <i class="fa fa-chevron-right" aria-hidden="true"></i>
        </button>
    </div>
</div>
<div *ngIf="commentsData?.length>0 || rejectsData?.length>0">
    <div class="col-xs-8"></div>
    <a [ngClass]="{'invisible' :!commentsData || commentsData.length==0}" id="comment-history" class="btn btn-primary col-xs-2 history-tab"
        (click)="showCommentsHistory()">Comment History
        <span class="badge">{{commentsData?.length}}</span>
    </a>
    <a [ngClass]="{'invisible' :!rejectsData || rejectsData.length==0}" id="reject-history" class="btn btn-danger col-xs-2 history-tab"
        (click)="showRejectsHistory()">Reject History
        <span class="badge">{{rejectsData?.length}}</span>
    </a>
</div>
<div [ngClass]="{'line-break-big': commentsData?.length==0 && rejectsData?.length==0}" class="col-xs-12 line-break"></div>
<div class="col-xs-12 paddingHorizontal12">
        <ngbd-alert-container ref="global"></ngbd-alert-container>
        <ngbd-alert-container ref="rejectsHistory"></ngbd-alert-container>
        <div class="row">
            <div class="ngbd-alert-container" [ngClass]="{'col-md-12' : (!showStepComments || commentsData?.length==0) , 'col-md-3 paddingRight' : (showCommentForm && showStepComments && commentsData?.length>0)}">    
                <div class="row alert alert-default nomargin animated bounceIn" [ngClass]="{'bounceOutLeft': commentFormClosing}" *ngIf="showCommentForm">
                    <div class="pull-right"> <button aria-label="Close" class="close" type="button" (click)="closeCommentForm()">Ã—</button></div>
                    <label [ngClass]="{'col-md-1 text-right' : (!showStepComments || commentsData?.length==0)}" class="paddingHorizontal3 paddingTop2">Comment</label>
                    <div [ngClass]="{'col-md-6' : (!showStepComments || commentsData?.length==0)}" class="paddingHorizontal3"><textarea  autosize class="form-control paddingVertical" maxlength="1000" [(ngModel)]='commentToAdd' rows="3"> </textarea></div>
                    <div [ngClass]="{'col-md-4' : (!showStepComments || commentsData?.length==0)}" class="">
                        <label [ngClass]="{'col-md-4 text-right' : (!showStepComments || commentsData?.length==0)}" class="paddingHorizontal3 paddingTop2">Next Due Date</label>
                        <div [ngClass]="{'col-md-8' : (!showStepComments || commentsData?.length==0)}" class="paddingHorizontal3">
                            <div>
                                <datepicker [(date)]="nextDueDate" [minDate]="today"></datepicker>
                            </div>
                            <div class="marginTop4">
                                <button class="btn btn-xs btn-default" (click)="addStepComment(commentToAdd, nextDueDate)" [disabled]="!commentToAdd">
                                    <i class="fa fa-floppy-o" aria-hidden="true"></i> Save Comment
                                </button> 
                            </div>              
                        </div>
                    </div>
                </div>
            </div>
            <div [ngClass]="showCommentForm ? 'col-md-9 paddingLeft' :  'col-md-12' ">  
                <ngbd-alert-container ref="commentsHistory" (onClose)="showStepComments = false"></ngbd-alert-container>
            </div>
        </div>
</div>

